<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="additionForest.pageTitle">Addition Forest Map - Math Planet</title>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/map.css">
  <link rel="stylesheet" href="../styles/exercise.css">
  
  <!-- Scripts -->
  <script src="../scripts/i18n.js" defer></script>
  <script type="module" src="../scripts/exercise-state.js"></script>
  <script type="module" src="../scripts/question-generator.js"></script>
  <script type="module" src="../scripts/castle-exercise.js"></script>
</head>
<body class="map-page">
  <div class="container">
    <!-- Language Switcher -->
    <div class="language-switcher-container">
      <label for="language-switcher" class="visually-hidden" data-i18n="languageSwitcher.label">Language</label>
      <select id="language-switcher" class="language-switcher" aria-label="Language">
        <option value="en">English</option>
        <option value="sv">Svenska</option>
      </select>
    </div>

    <!-- Map Container -->
    <main class="map-container">
      <div class="treasure-map">
        <!-- SVG Map with Path and Spots -->
        <!-- Linear progression viewBox: 1000x300 coordinate system -->
        <!-- Horizontal line from left to right with 10 evenly-spaced stations -->
        <!-- Stations at Y=150 (centered), X positions: 100, 200, 300, ..., 1000 -->
        <svg viewBox="0 0 1000 300" xmlns="http://www.w3.org/2000/svg" class="map-svg">
          <title>Addition Forest map with ten learning stations</title>
          
          <!-- Horizontal progression line connecting all stations -->
          <line 
            id="progression-line"
            class="map-path"
            x1="50" 
            y1="150" 
            x2="1050" 
            y2="150"
            stroke="#8D6E63"
            stroke-width="6"
            stroke-dasharray="12 4"
            stroke-linecap="round"
            opacity="0.6"
          />
          
          <!-- Station 1: Castle (Starting Point) - Interactive Element -->
          <g id="station-1" class="map-spot station-1 active" data-station="1" role="button" tabindex="0" 
             aria-label="Station 1: Castle - Starting Point"
             transform="translate(100, 150)">
            
            <!-- Castle Structure (centered on origin) -->
            <rect x="-25" y="-30" width="50" height="60" fill="#B0B0B0" stroke="#808080" stroke-width="2"/>
            <polygon points="-30,-30 30,-30 25,-50 -25,-50" fill="#909090" stroke="#707070" stroke-width="2"/>
            
            <!-- Castle Towers -->
            <rect x="-30" y="-45" width="15" height="25" fill="#B0B0B0" stroke="#808080" stroke-width="1"/>
            <rect x="15" y="-45" width="15" height="25" fill="#B0B0B0" stroke="#808080" stroke-width="1"/>
            <polygon points="-30,-45 -22.5,-60 -15,-45" fill="#909090"/>
            <polygon points="15,-45 22.5,-60 30,-45" fill="#909090"/>
            
            <!-- Castle Door -->
            <rect x="-10" y="5" width="20" height="25" fill="#654321" stroke="#4A3219" stroke-width="1"/>
            
            <!-- Castle Windows -->
            <rect x="-18" y="-15" width="10" height="10" fill="#FFE87C" stroke="#D4AF37" stroke-width="1"/>
            <rect x="8" y="-15" width="10" height="10" fill="#FFE87C" stroke="#D4AF37" stroke-width="1"/>
            
            <!-- Station indicator circle -->
            <circle cx="0" cy="0" r="45" fill="none" stroke="#4CAF50" stroke-width="3" class="station-indicator"/>
            <circle cx="0" cy="0" r="50" fill="rgba(76, 175, 80, 0.1)" class="station-glow"/>
            
            <!-- Station number badge -->
            <circle cx="35" cy="-35" r="12" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
            <text x="35" y="-31" text-anchor="middle" font-size="14" font-weight="bold" fill="#FFFFFF">1</text>
          </g>
          
          <!-- Station 2: Tree House - Locked -->
          <g id="station-2" class="map-spot station-2 locked" data-station="2" role="button" tabindex="0"
             aria-label="Station 2: Tree House - Locked"
             transform="translate(200, 150)">
            <!-- Simple tree trunk -->
            <rect x="-8" y="-20" width="16" height="40" fill="#8B4513" stroke="#654321" stroke-width="1"/>
            <!-- Tree foliage -->
            <circle cx="0" cy="-40" r="25" fill="#4CAF50" stroke="#2E7D32" stroke-width="2" opacity="0.7"/>
            <!-- House platform -->
            <rect x="-18" y="-35" width="36" height="20" fill="#D2691E" stroke="#A0522D" stroke-width="1" opacity="0.7"/>
            <!-- House window -->
            <rect x="-8" y="-30" width="10" height="10" fill="#87CEEB" opacity="0.5"/>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="35" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-45" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          <!-- Station 3: Fountain - Locked -->
          <g id="station-3" class="map-spot station-3 locked" data-station="3" role="button" tabindex="0"
             aria-label="Station 3: Fountain - Locked"
             transform="translate(300, 150)">
            <!-- Fountain base -->
            <ellipse cx="0" cy="10" rx="30" ry="8" fill="#87CEEB" stroke="#4682B4" stroke-width="2" opacity="0.7"/>
            <!-- Fountain pillar -->
            <rect x="-6" y="-15" width="12" height="25" fill="#C0C0C0" stroke="#999" stroke-width="1" opacity="0.7"/>
            <!-- Water spray -->
            <circle cx="0" cy="-20" r="3" fill="#87CEEB" opacity="0.7"/>
            <circle cx="-5" cy="-15" r="2" fill="#87CEEB" opacity="0.5"/>
            <circle cx="5" cy="-15" r="2" fill="#87CEEB" opacity="0.5"/>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="35" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-35" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          <!-- Station 4: Flower Garden - Locked -->
          <g id="station-4" class="map-spot station-4 locked" data-station="4" role="button" tabindex="0"
             aria-label="Station 4: Flower Garden - Locked"
             transform="translate(400, 150)">
            <!-- Garden bed -->
            <rect x="-25" y="5" width="50" height="15" fill="#8B4513" stroke="#654321" stroke-width="1" opacity="0.7"/>
            <!-- Flowers -->
            <circle cx="-15" cy="0" r="6" fill="#FF69B4" opacity="0.7"/>
            <circle cx="0" cy="-5" r="6" fill="#FFD700" opacity="0.7"/>
            <circle cx="15" cy="0" r="6" fill="#FF6347" opacity="0.7"/>
            <!-- Flower stems -->
            <line x1="-15" y1="0" x2="-15" y2="10" stroke="#228B22" stroke-width="2" opacity="0.7"/>
            <line x1="0" y1="-5" x2="0" y2="10" stroke="#228B22" stroke-width="2" opacity="0.7"/>
            <line x1="15" y1="0" x2="15" y2="10" stroke="#228B22" stroke-width="2" opacity="0.7"/>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="35" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-25" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          <!-- Station 5: Bridge - Locked -->
          <g id="station-5" class="map-spot station-5 locked" data-station="5" role="button" tabindex="0"
             aria-label="Station 5: Bridge - Locked"
             transform="translate(500, 150)">
            <!-- Bridge planks -->
            <rect x="-30" y="-5" width="60" height="10" fill="#8B4513" stroke="#654321" stroke-width="2" opacity="0.7"/>
            <line x1="-25" y1="-5" x2="-25" y2="5" stroke="#654321" stroke-width="1"/>
            <line x1="-10" y1="-5" x2="-10" y2="5" stroke="#654321" stroke-width="1"/>
            <line x1="10" y1="-5" x2="10" y2="5" stroke="#654321" stroke-width="1"/>
            <line x1="25" y1="-5" x2="25" y2="5" stroke="#654321" stroke-width="1"/>
            <!-- Bridge ropes -->
            <path d="M -30,-10 Q 0,-25 30,-10" fill="none" stroke="#8B4513" stroke-width="2" opacity="0.7"/>
            <path d="M -30,5 Q 0,20 30,5" fill="none" stroke="#8B4513" stroke-width="2" opacity="0.7"/>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="35" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-30" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          <!-- Station 6: Windmill - Locked -->
          <g id="station-6" class="map-spot station-6 locked" data-station="6" role="button" tabindex="0"
             aria-label="Station 6: Windmill - Locked"
             transform="translate(600, 150)">
            <!-- Windmill base -->
            <polygon points="-15,20 15,20 10,-20 -10,-20" fill="#D2691E" stroke="#A0522D" stroke-width="2" opacity="0.7"/>
            <!-- Windmill blades (simplified) -->
            <g transform="rotate(0)">
              <rect x="-3" y="-40" width="6" height="35" fill="#8B4513" stroke="#654321" stroke-width="1" opacity="0.7"/>
              <rect x="-20" y="-3" width="40" height="6" fill="#8B4513" stroke="#654321" stroke-width="1" opacity="0.7"/>
            </g>
            <!-- Window -->
            <rect x="-6" y="0" width="12" height="12" fill="#87CEEB" opacity="0.5"/>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="35" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-45" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          <!-- Station 7: Lighthouse - Locked -->
          <g id="station-7" class="map-spot station-7 locked" data-station="7" role="button" tabindex="0"
             aria-label="Station 7: Lighthouse - Locked"
             transform="translate(700, 150)">
            <!-- Lighthouse tower -->
            <rect x="-10" y="-30" width="20" height="50" fill="#FF6347" stroke="#DC143C" stroke-width="2" opacity="0.7"/>
            <!-- White stripe -->
            <rect x="-10" y="-10" width="20" height="10" fill="#FFFFFF" stroke="#DC143C" stroke-width="1" opacity="0.7"/>
            <!-- Lighthouse top -->
            <rect x="-12" y="-35" width="24" height="8" fill="#FFD700" stroke="#FFA000" stroke-width="2" opacity="0.7"/>
            <!-- Light beam -->
            <polygon points="-12,-35 -25,-40 -12,-30" fill="#FFFF00" opacity="0.3"/>
            <polygon points="12,-35 25,-40 12,-30" fill="#FFFF00" opacity="0.3"/>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="35" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-45" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          <!-- Station 8: Pond - Locked -->
          <g id="station-8" class="map-spot station-8 locked" data-station="8" role="button" tabindex="0"
             aria-label="Station 8: Pond - Locked"
             transform="translate(800, 150)">
            <!-- Pond water -->
            <ellipse cx="0" cy="5" rx="30" ry="18" fill="#4682B4" stroke="#1E3A8A" stroke-width="2" opacity="0.7"/>
            <!-- Lily pads -->
            <ellipse cx="-12" cy="0" rx="8" ry="6" fill="#2E7D32" opacity="0.7"/>
            <ellipse cx="10" cy="8" rx="8" ry="6" fill="#2E7D32" opacity="0.7"/>
            <!-- Fish -->
            <ellipse cx="0" cy="5" rx="5" ry="3" fill="#FFA500" opacity="0.7"/>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="35" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-25" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          <!-- Station 9: Tower - Locked -->
          <g id="station-9" class="map-spot station-9 locked" data-station="9" role="button" tabindex="0"
             aria-label="Station 9: Tower - Locked"
             transform="translate(900, 150)">
            <!-- Tower base -->
            <rect x="-15" y="-20" width="30" height="40" fill="#808080" stroke="#696969" stroke-width="2" opacity="0.7"/>
            <!-- Tower top -->
            <polygon points="-18,-20 18,-20 0,-45" fill="#A9A9A9" stroke="#696969" stroke-width="2" opacity="0.7"/>
            <!-- Tower windows -->
            <rect x="-8" y="-10" width="6" height="8" fill="#FFE87C" opacity="0.5"/>
            <rect x="2" y="-10" width="6" height="8" fill="#FFE87C" opacity="0.5"/>
            <rect x="-8" y="5" width="6" height="8" fill="#FFE87C" opacity="0.5"/>
            <rect x="2" y="5" width="6" height="8" fill="#FFE87C" opacity="0.5"/>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="35" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-50" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          <!-- Station 10: Treasure Chest (Final Destination) - Locked -->
          <g id="station-10" class="map-spot station-10 locked" data-station="10" role="button" tabindex="0"
             aria-label="Station 10: Treasure Chest - Final Destination"
             transform="translate(1000, 150)">
            <!-- Chest base -->
            <rect x="-20" y="0" width="40" height="25" fill="#8B4513" stroke="#654321" stroke-width="2" opacity="0.7"/>
            <!-- Chest lid -->
            <path d="M -20,0 Q 0,-15 20,0" fill="#A0522D" stroke="#654321" stroke-width="2" opacity="0.7"/>
            <!-- Chest lock -->
            <rect x="-5" y="8" width="10" height="8" fill="#FFD700" stroke="#FFA000" stroke-width="1" opacity="0.7"/>
            <!-- Treasure sparkles -->
            <g opacity="0.5">
              <path d="M -8,-8 L -6,-6 L -8,-4 L -6,-6 Z" fill="#FFD700"/>
              <path d="M 8,-8 L 6,-6 L 8,-4 L 6,-6 Z" fill="#FFD700"/>
            </g>
            <!-- Star marker on final station -->
            <g transform="translate(0, -30)" opacity="0.7">
              <path d="M 0,-8 L 2,-2 L 8,-2 L 3,2 L 5,8 L 0,4 L -5,8 L -3,2 L -8,-2 L -2,-2 Z" fill="#FFD700"/>
            </g>
            <!-- Lock indicator -->
            <circle cx="0" cy="0" r="40" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="4 4" opacity="0.5"/>
            <text x="0" y="-40" text-anchor="middle" font-size="12" fill="#666">🔒</text>
          </g>

          
        </svg>
      </div>
      
      <!-- Exercise Interaction Area (Initially hidden) -->
      <div id="interaction-area" class="interaction-area hidden" role="region" aria-labelledby="exercise-title">
        <!-- Princess Character -->
        <div class="princess-container">
          <svg class="princess-svg" width="100" height="120" viewBox="0 0 100 120" aria-hidden="true">
            <!-- Princess Crown -->
            <polygon points="40,20 50,10 60,20 55,25 45,25" fill="#FFD700" stroke="#FFA000" stroke-width="1"/>
            <circle cx="50" cy="25" r="3" fill="#FF1744"/>
            
            <!-- Princess Head -->
            <circle cx="50" cy="40" r="15" fill="#FFE0BD" stroke="#D4A574" stroke-width="1"/>
            
            <!-- Princess Hair -->
            <path d="M 35 35 Q 35 25, 50 25 Q 65 25, 65 35 Q 65 45, 60 50 L 40 50 Q 35 45, 35 35" fill="#8B4513" stroke="#654321" stroke-width="1"/>
            
            <!-- Princess Eyes -->
            <circle cx="45" cy="40" r="2" fill="#333"/>
            <circle cx="55" cy="40" r="2" fill="#333"/>
            
            <!-- Princess Smile -->
            <path d="M 45 45 Q 50 48, 55 45" stroke="#333" stroke-width="1" fill="none"/>
            
            <!-- Princess Dress -->
            <path d="M 50 55 L 35 100 L 40 100 L 50 75 L 60 100 L 65 100 Z" fill="#FF69B4" stroke="#C2185B" stroke-width="1"/>
            
            <!-- Princess Arms -->
            <line x1="40" y1="60" x2="30" y2="75" stroke="#FFE0BD" stroke-width="4" stroke-linecap="round"/>
            <line x1="60" y1="60" x2="70" y2="75" stroke="#FFE0BD" stroke-width="4" stroke-linecap="round"/>
          </svg>
        </div>
        
        <!-- Princess Message -->
        <div class="princess-message">
          <p id="princess-greeting" data-i18n="additionForest.exercise1.princessGreeting">Welcome to my castle! Let's practice addition together.</p>
        </div>
        
        <!-- Question Display -->
        <div class="question-display">
          <h2 id="exercise-title" class="sr-only" data-i18n="additionForest.exercise1.questionPrompt">Solve this addition problem</h2>
          <div id="question-text" class="question-text" role="text" aria-live="polite"></div>
        </div>
        
        <!-- Answer Input -->
        <div class="answer-input-container">
          <label for="answer-input" class="answer-label" data-i18n="additionForest.exercise1.inputLabel">Your answer:</label>
          <input 
            type="number" 
            id="answer-input" 
            class="answer-input" 
            data-i18n-placeholder="additionForest.exercise1.answerPlaceholder"
            placeholder="Enter your answer"
            aria-describedby="feedback-message"
            min="0"
            max="200"
          />
        </div>
        
        <!-- Submit Button -->
        <button id="submit-button" class="submit-button" data-i18n="additionForest.exercise1.submitButton">Check Answer</button>
        
        <!-- Feedback Message -->
        <div id="feedback-message" class="feedback-message" role="alert" aria-live="assertive"></div>
      </div>
      
      <!-- Navigation -->
      <nav class="map-navigation">
        <a href="../index.html" class="back-button" data-i18n="navigation.backToHome">← Back to Math Planet</a>
      </nav>
      
    </main>
  </div>
</body>
</html>
